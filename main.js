const translations = {
  en: {
    "meta.title": "Lion NDT - Nondestructive Consulting Services",
    "meta.description": "Lion NDT provides nondestructive testing consulting, training, inspections, and Nadcap readiness services across Florida for aviation and industrial clients.",
    "nav.home": "Home",
    "nav.services": "Services",
    "nav.about": "About Us",
    "nav.aboutShort": "About",
    "nav.contact": "Contact",
    "hero.tagline": "Pioneering Excellence in Nondestructive Consulting",
    "hero.description":
      "We provide advanced Nondestructive Testing (NDT) solutions, ensuring the integrity and reliability of your critical assets without compromising their structure. Our expert team delivers precision, safety, and peace of mind.",
    "hero.cta": "Request a Consultation",
    "services.title": "Our Consulting Services",
    "services.subtitle":
      "Specialized expertise to meet your industry's highest standards.",
    "services.ut.title": "Ultrasonic Testing (UT)",
    "services.ut.body":
      "High-frequency sound waves to detect internal flaws and characterize material thickness.",
    "services.mt.title": "Magnetic Particle Testing (MT)",
    "services.mt.body":
      "Detecting surface and near-surface discontinuities in ferromagnetic materials.",
    "services.pt.title": "Liquid Penetrant Testing (PT)",
    "services.pt.body":
      "Revealing surface-breaking defects in non-porous materials through dye bleed-out.",
    "services.rt.title": "QA/QC Consulting",
    "services.rt.body":
      `We assist aerospace and related organizations in complying with EASA, FAA, CAAC, and CAA regulations by developing and reviewing their Quality Management Systems, including AS9100, AS9110, RSQCM, RSM, and QCM manuals, procedures, and Safety Management Systems (SMS). 
      Our services include gap assessments, risk evaluations, corrective action plan development, and internal audits in line with regulatory standards. 
      We also provide comprehensive audit reports and tailored recommendations.`,
    "services.vt.title": "Visual Testing (VT)",
    "services.vt.body":
      "Systematic observation of surfaces to identify discontinuities without equipment.",
    "services.pd.title": "Procedure Development",
    "services.pd.body":
      "Creating and validating NDT procedures to meet specific codes, standards, and client needs.",
    "services.cwi.title": "Certified Welding Inspections (CWI)",
    "services.cwi.body": `Certified Welding Inspections (CWI) provide expert visual inspections of welds on aircraft or industrial structures to ensure compliance with AWS D1.1 (steel) and D17.1 (aerospace) standards.
Services include defect detection, compliance checks, pre/post-weld evaluation, thorough reporting, and corrective recommendations.`,
    "services.nc.title": "NADCAP Accreditation",
    "services.nc.item1": "Gap analysis to identify areas for improvement.",
    "services.nc.item2": "Documentation assistance for quality manuals and procedures.",
    "services.nc.item3": "Staff training on NADCAP standards and audit preparation.",
    "services.nc.item4": "Mock audits for compliance assessment and feedback.",
    "services.nc.item5": "Help with corrective action plans for audit findings.",
    "services.nc.item6": "Ongoing consultation to ensure sustained compliance.",
    "services.ndt.title": "NDT Level III Services",
    "services.ndt.item1": "Develop and review of the written practice, procedures and technique sheets.",
    "services.ndt.item2": "We provide classroom training and certification for NDT Level I, II, and III personnel in accordance with SNT-TC-1A, NAS 410, and other industry standards.",
    "services.ndt.item3": "Conduct proficiency evaluations and vision examinations for both NDT personnel and Quality Inspectors.",
    "services.ndt.item4": "Perform Probability of Detection (POD) studies.",
    "services.ndt.item5": "NDT department design and implementation support.",

    "about.title": "About Lion NDT",
    "about.body1":
      "Lion NDT is a leading provider of Nondestructive Testing (NDT) and inspection services. We are dedicated to delivering high-quality, reliable, and efficient solutions that ensure the safety and integrity of our clients' assets.",
    "about.body2":
      "Our mission is to be the trusted partner for industries that rely on the performance of their critical components. We combine state-of-the-art technology with the deep expertise of our certified professionals to offer unparalleled service and insights, helping you mitigate risk and optimize operations.",
    "contact.title": "Get in Touch",
    "contact.subtitle":
      "Have a project in mind or need expert advice? Contact us today.",
    "contact.name": "Full Name",
    "contact.email": "Email Address",
    "contact.message": "Message",
    "contact.submit": "Send Message",
    "contact.successMessage": "Message sent. Thank you for reaching out!",
    "contact.errorMessage": "Could not send the message. Please try again.",
    "footer.copy": "© 2025 Lion NDT. All Rights Reserved.",
  },
  es: {
    "meta.title": "Lion NDT - Servicios de consultoría END",
    "meta.description": "Lion NDT ofrece consultoría, capacitación, inspecciones y preparación para Nadcap en Ensayos No Destructivos (END) en toda Florida para clientes de aviación e industria.",
    "nav.home": "Inicio",
    "nav.services": "Servicios",
    "nav.about": "Sobre nosotros",
    "nav.aboutShort": "Sobre",
    "nav.contact": "Contacto",
    "hero.tagline": "Excelencia pionera en consultoría de ensayos no destructivos",
    "hero.description":
      "Ofrecemos soluciones avanzadas de Ensayos No Destructivos (END) para garantizar la integridad y la confiabilidad de sus activos críticos sin comprometer su estructura. Nuestro equipo experto entrega precisión, seguridad y tranquilidad.",
    "hero.cta": "Solicitar una consulta",
    "services.title": "Nuestros servicios de consultoría",
    "services.subtitle":
      "Especialistas listos para cumplir con los más altos estándares de la industria.",
    "services.ut.title": "Ultrasonic Testing (UT)",
    "services.ut.body":
      "Ondas de sonido de alta frecuencia para detectar fallas internas y medir espesores.",
    "services.mt.title": "Magnetic Particle Testing (MT)",
    "services.mt.body":
      "Detección de discontinuidades superficiales y cercanas a la superficie en materiales ferromagnéticos.",
    "services.pt.title": "Liquid Penetrant Testing (PT)",
    "services.pt.body":
      "Revela defectos abiertos a la superficie en materiales no porosos mediante tintes penetrantes.",
    "services.rt.title": "QA/QC Consulting",
    "services.rt.body":
      "Uso de rayos X o gamma para ver la estructura interna de los componentes.",
    "services.vt.title": "Visual Testing (VT)",
    "services.vt.body":
      "Inspección visual sistemática para identificar discontinuidades sin equipo adicional.",
    "services.pd.title": "Desarrollo de procedimientos",
    "services.pd.body":
      "Creación y validación de procedimientos END según códigos, normas y necesidades del cliente.",
    "services.cwi.title": "Inspecciones de soldadura certificadas (CWI)",
    "services.cwi.body": `Las Inspecciones de Soldadura Certificadas (CWI) proporcionan inspecciones visuales expertas de soldaduras en aeronaves o estructuras industriales para garantizar el cumplimiento de los estándares AWS D1.1 (acero) y D17.1 (aeroespacial).
Los servicios incluyen detección de defectos, verificación de cumplimiento, evaluación antes y después de la soldadura, informes detallados y recomendaciones correctivas.`,
    "services.nc.title": "Acreditación NADCAP",
    "services.nc.item1": "Análisis de brechas para identificar áreas de mejora.",
    "services.nc.item2": "Apoyo documental para manuales de calidad y procedimientos.",
    "services.nc.item3": "Capacitación del personal en estándares NADCAP y preparación de auditorías.",
    "services.nc.item4": "Auditorías simuladas para evaluar cumplimiento y brindar retroalimentación.",
    "services.nc.item5": "Ayuda con planes de acción correctiva ante hallazgos de auditoría.",
    "services.nc.item6": "Consultoría continua para mantener el cumplimiento.",
    "services.ndt.title": "Servicios de Nivel III END",
    "services.ndt.item1": "Desarrollar y revisar Hojas de Procedimiento y Técnica.",
    "services.ndt.item2": "Brindar capacitación y certificación para aprendices y personal END Nivel I, II y III. personal de acuerdo con SNT-TC-1A, NAS 410 y otros estándares de la industria.",
    "services.ndt.item3": "Realizar evaluaciones de competencia y exámenes de visión tanto para el personal de END como para los inspectores de calidad.",
    "services.ndt.item4": "Realizar estudios de Probabilidad de Detección (POD).",
    "about.title": "Acerca de Lion NDT",
    "about.body1":
      "Lion NDT es un proveedor líder de servicios de Ensayos No Destructivos (END) e inspección. Nos dedicamos a entregar soluciones de alta calidad, confiables y eficientes que aseguren la seguridad e integridad de los activos de nuestros clientes.",
    "about.body2":
      "Nuestra misión es ser el socio de confianza para las industrias que dependen del rendimiento de sus componentes críticos. Combinamos tecnología de punta con la profunda experiencia de nuestros profesionales certificados para ofrecer un servicio y conocimientos inigualables, ayudándole a mitigar riesgos y optimizar operaciones.",
    "contact.title": "Ponte en contacto",
    "contact.subtitle":
      "¿Tienes un proyecto en mente o necesitas asesoría? Escríbenos hoy mismo.",
    "contact.name": "Nombre completo",
    "contact.email": "Correo electrónico",
    "contact.message": "Mensaje",
    "contact.submit": "Enviar mensaje",
    "contact.successMessage": "Mensaje enviado. ¡Gracias por contactarnos!",
    "contact.errorMessage": "No se pudo enviar el mensaje. Inténtalo de nuevo.",
    "footer.copy": "© 2025 Lion NDT. Todos los derechos reservados.",
  },
};

document.addEventListener("DOMContentLoaded", () => {
  const SERVICE_ID = "service_d3p5kvs";
  const TEMPLATE_INTERNAL_ID = "template_k2rgyex"; // correo que recibes tú
  const TEMPLATE_USER_ID = "template_gvre3bm"; // auto-reply al usuario
  const PUBLIC_KEY = "5SIQdvZnQLQ2ZEdVI";
  let emailJsReady = null;

  const langButtons = document.querySelectorAll(".lang-btn");
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileMenuIcon = document.getElementById("mobile-menu-icon");
  const contactForm = document.getElementById("contact-form");
  const heroSection = document.querySelector("[data-hero-rotator]");
  const heroBackgrounds = document.querySelectorAll("[data-hero-bg]");
  let currentLang = localStorage.getItem("preferredLang") || "en";
  let heroInterval;

  const ensureEmailJs = () => {
    if (window.emailjs) {
      if (!window.emailjs.__initialized) {
        window.emailjs.init(PUBLIC_KEY);
        window.emailjs.__initialized = true;
      }
      return Promise.resolve(window.emailjs);
    }

    if (!emailJsReady) {
      emailJsReady = new Promise((resolve, reject) => {
        const script = document.createElement("script");
        script.src = "https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js";
        script.onload = () => {
          if (window.emailjs) {
            window.emailjs.init(PUBLIC_KEY);
            window.emailjs.__initialized = true;
            resolve(window.emailjs);
          } else {
            reject(new Error("EmailJS no disponible tras cargar el script."));
          }
        };
        script.onerror = () => reject(new Error("No se pudo cargar EmailJS."));
        document.head.appendChild(script);
      });
    }

    return emailJsReady;
  };

  const applyTranslations = (lang = "en") => {
    currentLang = lang;
    const dictionary = translations[lang] || translations.en;

    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.getAttribute("data-i18n");
      if (dictionary[key]) {
        el.textContent = dictionary[key];
      }
    });

    document.title = dictionary["meta.title"] || document.title;
    const metaDescription = document.querySelector('meta[name="description"]');
    if (metaDescription && dictionary["meta.description"]) {
      metaDescription.setAttribute("content", dictionary["meta.description"]);
    }
    const ogTitle = document.querySelector('meta[property="og:title"]');
    if (ogTitle && dictionary["meta.title"]) {
      ogTitle.setAttribute("content", dictionary["meta.title"]);
    }
    const ogDescription = document.querySelector('meta[property="og:description"]');
    if (ogDescription && dictionary["meta.description"]) {
      ogDescription.setAttribute("content", dictionary["meta.description"]);
    }
    const twitterTitle = document.querySelector('meta[name="twitter:title"]');
    if (twitterTitle && dictionary["meta.title"]) {
      twitterTitle.setAttribute("content", dictionary["meta.title"]);
    }
    const twitterDescription = document.querySelector('meta[name="twitter:description"]');
    if (twitterDescription && dictionary["meta.description"]) {
      twitterDescription.setAttribute("content", dictionary["meta.description"]);
    }

    document.documentElement.setAttribute("lang", lang);

    langButtons.forEach((btn) => {
      const isActive = btn.dataset.lang === lang;
      btn.classList.toggle("bg-primary", isActive);
      btn.classList.toggle("text-white", isActive);
      btn.classList.toggle("text-primary", !isActive);
      btn.setAttribute("aria-pressed", isActive);
    });
  };

  applyTranslations(currentLang);

  const startHeroRotation = () => {
    if (!heroSection || heroBackgrounds.length < 2) return;
    const heroImages = ["assets/2.jpeg", "assets/drone.jpeg", "assets/3.jpeg", "assets/4.jpeg", "assets/5.jpeg", "assets/6.jpeg", "assets/7.jpeg", "assets/8.jpeg", "assets/9.jpeg"];
    let current = 0;

    // Preload to reduce flicker
    heroImages.forEach((src) => {
      const img = new Image();
      img.src = src;
    });

    // Seed initial layers
    heroBackgrounds[0].style.backgroundImage = `url('${heroImages[0]}')`;
    heroBackgrounds[1].style.backgroundImage = `url('${heroImages[1 % heroImages.length]}')`;

    clearInterval(heroInterval);
    heroInterval = setInterval(() => {
      const nextIndex = (current + 1) % heroImages.length;
      const incomingLayer = heroBackgrounds[(current + 1) % 2];
      const outgoingLayer = heroBackgrounds[current % 2];

      incomingLayer.style.backgroundImage = `url('${heroImages[nextIndex]}')`;
      incomingLayer.classList.remove("opacity-0");
      incomingLayer.classList.add("opacity-100");

      outgoingLayer.classList.remove("opacity-100");
      outgoingLayer.classList.add("opacity-0");

      current = (current + 1) % heroImages.length;
    }, 7000);
  };

  startHeroRotation();

  const toggleMobileMenu = (forceOpen) => {
    if (!mobileMenu || !mobileMenuButton || !mobileMenuIcon) return;
    const isOpen =
      typeof forceOpen === "boolean"
        ? forceOpen
        : mobileMenu.classList.contains("hidden");
    mobileMenu.classList.toggle("hidden", !isOpen);
    mobileMenuButton.setAttribute("aria-expanded", String(isOpen));
    mobileMenuIcon.textContent = isOpen ? "close" : "menu";
  };

  if (mobileMenuButton) {
    mobileMenuButton.addEventListener("click", () => {
      const isHidden = mobileMenu?.classList.contains("hidden");
      toggleMobileMenu(!!isHidden);
    });
  }

  mobileMenu?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => toggleMobileMenu(false));
  });

  langButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.getAttribute("data-lang") || "en";
      localStorage.setItem("preferredLang", lang);
      applyTranslations(lang);
      // Cerrar el menú móvil al elegir idioma
      toggleMobileMenu(false);
    });
  });

  if (contactForm) {
    contactForm.addEventListener("submit", (event) => {
      event.preventDefault();

      ensureEmailJs()
        .then((email) =>
          Promise.all([
            email.sendForm(SERVICE_ID, TEMPLATE_INTERNAL_ID, contactForm),
            email.sendForm(SERVICE_ID, TEMPLATE_USER_ID, contactForm),
          ])
        )
        .then(() => {
          const dict = translations[currentLang] || translations.en;
          alert(
            dict["contact.successMessage"] ||
              "Message sent. We have also sent you a confirmation email."
          );
          contactForm.reset();
        })
        .catch((error) => {
          console.error(error);
          const dict = translations[currentLang] || translations.en;
          alert(
            dict["contact.errorMessage"] ||
              "Could not send your message. Please try again."
          );
        });
    });
  }
});
